<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
    <!--<link rel="stylesheet" type="text/css" href="css/login.css">-->
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css" media="screen,projection" />
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/googleOAuth.js"></script>
    <!--Import jQuery before materialize.js-->
    <script type="text/javascript" src="js/materialize.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/0.10.0/lodash.min.js"></script>
    <title>Lab Overview</title>
</head>

<body class="green lighten-2">
    <!--Navigation Bar-->
    <ul class="side-nav" id="mobile">
        <li class="logo center">
            <img src=" img/logo.png" />
        </li>
        <li><a href="#!" onclick="display('viewalllab');">Lab View</a></li>
        <li class="active"><a href="#!"  onclick="display('viewalltasks');">Tasks</a></li>
        <li><a href="#!">Recipes</a></li>
        <li ><a href="#!">Function Calculator</a></li>
    </ul>
    <div class="navbar-fixed">
        <nav>
            <div class="nav-wrapper green">
                <div class="container">
                    <a href="#!" class="brand-logo">ChemStock</a>
                    <a href="#!" data-activates="mobile" class="button-collapse">
                        <i class="material-icons">menu</i>
                    </a>
                    <ul class="right hide-on-med-and-down">
                        <li><a href="#!">Lab View</a></li>
                        <li><a href="#!">Tasks</a></li>
                        <li><a href="#!">Recipes</a></li>
                        <li><a href="#!">Function Calculator</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>

    <br />

    <!--Loading Circle-->
    <div class="preloader-wrapper big active" id="loadingDiv" style="position:fixed; top:50%; left:50%; z-index: 1;">
        <div class="spinner-layer spinner-blue-only">
            <div class="circle-clipper left">
                <div class="circle"></div>
            </div><div class="gap-patch">
                <div class="circle"></div>
            </div><div class="circle-clipper right">
                <div class="circle"></div>
            </div>
        </div>
    </div>

    <!--Add New Task Button-->
    <a class="btn-floating btn-large red modal-trigger" style="position:fixed;right:3%;bottom:3%" href="#add_task">
        <i class="large material-icons">mode_edit</i>
    </a>

    <!--Add New Task Button-->
    <a class="btn-floating btn-large red modal-trigger" style="position:fixed;left:3%;bottom:3%" href="#current_task">
        <i class="large material-icons">mode_edit</i>
    </a>
    <!--Top View Area-->
    <div class=" row" >

        <!--Application Card-->
        <div class="col s12">
            <div class="card  darken-1 z-depth-1">
                <div class="card-content ">
                    <h5 class="card-title" jd="view_lab_name">CHEM 122</h5>
                    <br />
                    <div class="col s10"><span class="black-text">Pending Tasks: <span id="app_num">0</span></span></div>
                    <div class="col s10"><span class="black-text">Pending Tasks: <span id="app_num">0</span></span></div>
                    <div class="col s10"><span class="black-text">Pending Tasks: <span id="app_num">0</span></span></div>
                </div>
                <div class="card-action">
                    <a href="#" class=" green-text " onclick="display('app');">View Applications</a>
                </div>
            </div>
        </div>
        
    </div>

    <!--Bottom View Area-->
    <div class=" row ">
        <div  id="viewalltasks"class="col s12" >
            <div class="card-panel z-depth-1">
                <h5>Tasks</h5>
                <div class=" divider"></div>

                <div id="pend" class=" col s12">
                    <div class="collection">
                        <a href="#!" class="collection-item">Alvin</a>
                        <a href="#!" class="collection-item active">Alvin</a>
                        <a href="#!" class="collection-item">Alvin</a>
                        <a href="#!" class="collection-item">Alvin</a>
                    </div>
                </div>
                <p id="timestamp">Last Updated 11:9:17</p>
            </div>
        </div>
        <div id="viewalllab" class=" col s12 hide">
            <div class="card-panel z-depth-1">
                <h5>Experiments</h5>
                <!--<div class=" divider"></div>-->

                <div class=" col s12">
                    <div class="collection">
                        <a href="#!" class="collection-item">Alvin</a>
                        <a href="#!" class="collection-item active">Alvin</a>
                        <a href="#!" class="collection-item">Alvin</a>
                        <a href="#!" class="collection-item">Alvin</a>
                    </div>
                </div>


                <p id="timestamp">Last Updated 11:9:17</p>
            </div>
        </div>


    </div>


    <!--Different Modal Templates-->
    <div>

        <!--Lab View-->
        <div id="lab_view" class="modal  modal-fixed-footer">
            <div class="modal-content ">
                <div class="modal-body">
                    <div class=" row">
                        <div class="col s12 left">
                            <h3 class="left" id="lab_name"> Lab Name</h3>
                        </div>

                    </div>
                    <div class="divider"></div>

                    <ul class="collapsible" data-collapsible="expandable" id="lab_collap"></ul>

                </div>
            </div>
            <div class="modal-footer">
                <a href="#!" class="modal-action modal-close waves-effect waves-green btn green ">Close</a>
            </div>
        </div>

        <!--Lab View-->
        <div id="add_task" class="modal  modal-fixed-footer" style="width:90% !important">
            <div class="modal-content ">
                <div class="modal-body">
                    <div class=" row">
                        <div class="col s12 left">
                            <h3 class="left" id="lab_name"> Lab Name</h3>
                        </div>

                    </div>
                    <div class="divider"></div>

                    <div class="row">
                        <form class="col s12">
                            <div class="row">
                                <div class="input-field col s6">
                                    <input placeholder="Placeholder" id="first_name" type="text" class="validate">
                                    <label for="first_name">First Name</label>
                                </div>
                                <div class="input-field col s6">
                                    <input id="last_name" type="text" class="validate"><br />
                                    <label for="last_name">Last Name</label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="input-field col s12">
                                    <input disabled value="I am not editable" id="disabled" type="text" class="validate">
                                    <label for="disabled">Disabled</label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="input-field col s12">
                                    <input id="password" type="password" class="validate">
                                    <label for="password">Password</label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="input-field col s12">
                                    <input id="email" type="email" class="validate">
                                    <label for="email">Email</label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col s12">
                                    This is an inline input field:
                                    <div class="input-field inline">
                                        <input id="email" type="email" class="validate">
                                        <label for="email" data-error="wrong" data-success="right">Email</label>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a href="#!" class="modal-action modal-close waves-effect waves-green btn green ">Close</a>
            </div>
        </div>

        <!--Lab View-->
        <div id="current_task" class="modal  modal-fixed-footer" style="width:90% !important">
            <div class="modal-content ">
                <div class="modal-body">
                    <div class=" row">
                     
                            <h4 class="left" id="task_name"> Task Name</h4>
                  
                    
                            <h6 class="left" id="ltask_date"> Task Date</h6>
                        
                    </div>
                    <div class="divider"></div>
                    <p id="task_content">This is the description</p>
                    <div class="row">
                        <a class="btn">Hi</a>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a href="#!" class="modal-action modal-close waves-effect waves-green btn green ">Close</a>
            </div>
        </div>
    </div>

    <script>

        $apps = new Array();
        $exp = new Array();

        var groupedData;
        $numOfApps = 0;

        //Materialize CSS setup calls
        $(document).ready(function () {
            $('.modal').modal();
            $('.collapsible').collapsible();
            $('ul.tabs').tabs();
            $('ul.tabs').tabs('select_tab', 'tab_id');
            $(".button-collapse").sideNav();
            $('#timestamp').html(
                function () {
                    var time = new Date();

                    return "Last time checked:  " + time.toUTCString();
                }
            );
        });


        //Loading Indicatior for any ajax calls
        var $loading = $('#loadingDiv').hide();
        $(document)
            .ajaxStart(function () {
                $loading.show();
            })
            .ajaxStop(function () {
                $loading.hide();
            });

        //Grabs applications (its window on load because applications are by default)
        window.onload = (function () {
            $.ajax
                ({
                    type: "GET",
                    url: "https://www.bradfriebe.com/chemstock/getapplication.php",
                    crossDomain: true,
                    dataType: "json",
                    success: function (data) {

                        $apps = data;
                        $.each(data, function (key, value) {
                            $('#folla').append(
                                "<li class='collection-item avatar'><i class='material-icons circle red'>face</i>" +
                                "<span class='title'>" + value.firstName + " " + value.lastName + "</span >" +
                                "<p>" + value.email + " <br>" + value.cellPhone + "</p><a href='#app_view' class='waves-effect waves-light btn secondary-content modal-trigger' id = " + key + " onclick='populate_modal(this.id);' >View Application</a> </li>"
                            );
                            //$numOfApps = $numOfApps + 1;
                            $('#app_num').html($numOfApps += 1);
                        });
                        console.log($apps);
                    },
                    error: function (data) {
                        alert('There was an error getting application info');
                    }
                });

        });

        //Grabs current lab setup
        $(document).ready(function () {

            $.ajax
                ({
                    type: "GET",
                    url: "https://www.bradfriebe.com/chemstock/getexperiments.php",
                    crossDomain: true,
                    dataType: "json",
                    success: function (data) {
                        $exp = data;
                        groupedData = _.groupBy($exp, function (d) { return d.labID });
                        $.each(groupedData, function (key, value) {
                            custom_filter(value);
                        });
                    },
                    error: function (data) {
                        alert('There was an error getting application info');
                    }
                });
        });

        //Filters through the experiments
        function custom_filter(id_name) {

            $('#labarea').append(
                "<div class='divider'></div></br><div class='row valign-wrapper'><div class='col s2'><span class='black-text'><b>" + id_name[0].labName + "</b></span></div>" +


                " <div class='col s2'>" +

                " <a href='#lab_view' class='waves-effect waves-light btn green secondary-content modal-trigger' id=" + id_name[0].labID + " onclick='populate_modal_exp(this.id);' >View Lab</a>" +
                "</div> </div> "

            );

            $('#side_lab_links').append(
                " <li><a href='#lab_view' class=' modal-trigger' id=" + id_name[0].labID + " onclick='populate_modal_exp(this.id);' >CHEM " + id_name[0].labID + '</a ></li >'

            );

        }

        //Populates modals for application
        function populate_modal(id_name) {
            //Basic Information
            $('#app_status').html($apps[id_name].applicationStatus);
            $('#app_name').html($apps[id_name].firstName + " " + (($apps[id_name].middleInitial == null) ? "" : $apps[id_name].middleInitial) + " " + $apps[id_name].lastName);
            $('#app_email').html("<b>Email:</b> " + $apps[id_name].email);
            $('#app_homephone').html("<b>Home Phone:</b> " + $apps[id_name].homePhone);
            $('#app_cellphone').html("<b>Cell Phone:</b> " + $apps[id_name].cellPhone);
            $('#app_studentid').html("<b>Student Id:</b> E" + $apps[id_name].studentID);
            $('#app_timestamp').html("Submitted: " + $apps[id_name].timestamp);
            $('#app_localaddress').html("<b>Local Address: </b></br>" + $apps[id_name].localAddress + "</br>" + $apps[id_name].localCity + "," + $apps[id_name].localState + " " + $apps[id_name].localZip);
            $('#app_homeaddress').html("<b>Home Address: </b></br>" +
                (($apps[id_name].homeAddress == null) ? "Same As Local" : ($apps[id_name].homeAddress + "</br>" + $apps[id_name].homeCity + "," + $apps[id_name].homeState + " " + $apps[id_name].homeZip)));
            $('#app_birth').html("<b>Date of Birth: </b> " + $apps[id_name].dateOfBirth);
            $('#app_standing').html("<b>Class Standing:</b> " + $apps[id_name].classStanding);
            $('#app_cgpa').html("<b>College GPA:</b> " + $apps[id_name].collegeGPA);
            $('#app_graduationDate').html("<b>Graduation Date:</b> " + $apps[id_name].graduationDate);
            $('#app_hgpa').html("<b>High School GPA:</b> " + $apps[id_name].highschoolGPA);
            $('#app_major').html("<b>Major:</b> " + $apps[id_name].major);
            $('#app_minor').html("<b>Minor:</b> " + (($apps[id_name].minor == null) ? "Does Not Have One" : $apps[id_name].minor));
            $('#app_workhours').html("<b>Preferred Weekly Hours:</b> " + $apps[id_name].preferredWeeklyHours);
            $('#app_referral').html("<b>Referral:</b> " + $apps[id_name].referral);
            $('#app_wsa').html("<b>Work Study Approved?:</b> " + $apps[id_name].workStudyApproved);
            $('#app_wasAmt').html("<b>Work Study Amount:</b> " + $apps[id_name].workStudyHours);
            return "#" + id_name;
        }

        //Populates modals for experiments
        function populate_modal_exp(id_lab) {

            $('#lab_collap').html("");
            $('#lab_name').html("<h5>" + groupedData[id_lab][0].labName + "</h5>");

            $.each(groupedData[id_lab], function (key, value) {
                $('#lab_collap').append(
                    "<li>" +
                    " <div class='collapsible-header'><i class='material-icons'>filter_drama</i><span>" + value.experimentName + "</span ></div >" +
                    "<div class='collapsible-body'></div></li>"
                );
            });
        }

        //Switches application and lab views
        function display(id_name) {
            console.log(id_name);
            if (id_name == "viewalllab") {
                $('#viewalltasks').addClass("hide");
                $('#viewalllab').removeClass("hide");
            } else {
                $('#viewalltasks').removeClass("hide");
                $('#viewalllab').addClass("hide");
            }
        };


    </script>
</body>
</html>