<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
    <!--<link rel="stylesheet" type="text/css" href="css/login.css">-->
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css" media="screen,projection" />
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/googleOAuth.js"></script>
    <!--Import jQuery before materialize.js-->
    <script type="text/javascript" src="js/materialize.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/0.10.0/lodash.min.js"></script>
    <script type="text/javascript" src="js/main.js"></script>
    <title>Lab Overview</title>
</head>

<body class="green lighten-2">
    <!--Navigation Bar-->
    <ul class="side-nav" id="mobile">
        <li class="logo center">
            <img src=" img/logo.png" />
        </li>
        <li><a href="#!" onclick="display('viewalllab');">Lab View</a></li>
        <li class="active"><a href="#!" onclick="display('viewalltasks');">Tasks</a></li>
        <li><a href="#!" onclick="display('viewallemp');">Contact Staff</a></li>
        <li><a href="#!">Recipes</a></li>
        <li><a href="calculator.html">Function Calculator</a></li>
    </ul>
    <div class="navbar-fixed">
        <nav>
            <div class="nav-wrapper green">
                <div class="container">
                    <a href="#!" class="brand-logo">ChemStock</a>
                    <a href="#!" data-activates="mobile" class="button-collapse" onclick="IconSwap();">
                        <i class="material-icons" id="menu_icon" >menu</i>
                    </a>
                    <ul class="right hide-on-med-and-down">
                        <li><a href="#!">Lab View</a></li>
                        <li><a href="#!">Tasks</a></li>
                        <li><a href="#!">Contact Staff</a></li>
                        <li><a href="#!">Recipes</a></li>
                        <li><a href="calculator.html">Function Calculator</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>

    <br />

    <!--Loading Circle-->
    <div class="preloader-wrapper big active" id="loadingDiv" style="position:fixed; top:50%; left:50%; z-index: 1;">
        <div class="spinner-layer spinner-blue-only">
            <div class="circle-clipper left">
                <div class="circle"></div>
            </div><div class="gap-patch">
                <div class="circle"></div>
            </div><div class="circle-clipper right">
                <div class="circle"></div>
            </div>
        </div>
    </div>


    <!--View Area-->

    <div class=" row " id="bottom_view">

        <div id="recipe_search" class="col s12">
            <nav>
                <div class="nav-wrapper green lighten-4">
                    <form>
                        <div class="input-field">
                            <input id="search" type="search" required>
                            <label class="label-icon" for="search"><i class="material-icons">search</i></label>
                            <i class="material-icons">close</i>
                        </div>
                    </form>
                </div>
            </nav>

            <div class="card-panel z-depth-1">
                <h5>Recipes: All</h5>
                <div class=" divider"></div>

                <div id="pend" >
                    <ul class="collection">
                        <li class="collection-item"><div>Potassium Permagnate<a href="#!" class="secondary-content" ><i class="material-icons">send</i></a></div></li>
                        <li class="collection-item"><div>Methenol<a href="#!" class="secondary-content" onclick="toggle_view('recipe_view');"><i class="material-icons">send</i></a></div></li>
                        <li class="collection-item"><div>CHEM 122 Lab Final Unknowns<a href="#!" class="secondary-content"><i class="material-icons">send</i></a></div></li>
                        <li class="collection-item"><div>pH 4, 7 Buffer<a href="#!" class="secondary-content"><i class="material-icons">send</i></a></div></li>
                    </ul>
                </div>
                <p id="timestamp">Last Updated 11:9:17</p>
            </div>
        </div>
        <div id="recipe_view" class=" col s12 hide">
            <div class="card-panel z-depth-1">
                <h4 id="recipe_name">0.050 M Methanol</h4>
                <div class=" divider"></div>
                <br />
                 <h5 id="recipe_amt" ><b>Prep Quantity: </b>2L</h5>
                <h5 id="recipe_expTitle"><b>Experiment: </b><br />CHEM 122 Conductivity</h5>
                <h5 id="recipe_required"><b>Reqired Chemicals: </b>Methanol(4ml), Water(1996ml)</h5>
                <h5 id="recipe_formula"><b>Formula/FW:</b><br /> CH4O , 32.04 g/mol</h5>

                <h5><b>Procedure:</b></h5>
                <p id="recipe_text" class="flow-text">
                    With a 2 L volumetric flask,  fill roughly quarter ways with distilled water. Measure out
                    4 mls of methanol and add to flask. Use squirt bottle to get all the methanol to the flask. Fill to line
                    making sure that the closer you get to the mark, to switch to squirt bottle and eye dropper to avoid going over. 
                    Once finished, add stir bar to flask and stir for roughly 20 mins.
                </p>
                <p id="timestamp">Last Updated 11:9:17</p>
            </div>
        </div>
        <div id="recipe_edit" class=" col s12 hide">
            <div class="card-panel z-depth-1">
                <h5>Experiments</h5>
                <div class=" divider"></div>
                <br />

                <ul class="collapsible" data-collapsible="accordion" id="exp_collection"></ul>



                <p id="timestamp">Last Updated 11:9:17</p>
            </div>
        </div>
        <div id="recipe_add" class=" col s12 hide">
            <div class="card-panel z-depth-1">
                <h5>Experiments</h5>
                <div class=" divider"></div>
                <br />

                <ul class="collapsible" data-collapsible="accordion" id="exp_collection"></ul>



                <p id="timestamp">Last Updated 11:9:17</p>
            </div>
        </div>
    </div>


    <!--Different Modal Templates-->
    <div>

        <!--Add Task Modal-->
        <div id="add_task" class="modal  modal-fixed-footer" style="width:90% !important">
            <div class="modal-content ">
                <div class="modal-body">
                    <div class=" row">
                        <div class="col s12 left">
                            <h3 class="left" id="lab_name"> Lab Name</h3>
                        </div>

                    </div>
                    <div class="divider"></div>

                    <div class="row">
                        <form class="col s12">
                            <div class="row">
                                <div class="input-field col s6">
                                    <input placeholder="Placeholder" id="first_name" type="text" class="validate">
                                    <label for="first_name">First Name</label>
                                </div>
                                <div class="input-field col s6">
                                    <input id="last_name" type="text" class="validate"><br />
                                    <label for="last_name">Last Name</label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="input-field col s12">
                                    <input disabled value="I am not editable" id="disabled" type="text" class="validate">
                                    <label for="disabled">Disabled</label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="input-field col s12">
                                    <input id="password" type="password" class="validate">
                                    <label for="password">Password</label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="input-field col s12">
                                    <input id="email" type="email" class="validate">
                                    <label for="email">Email</label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col s12">
                                    This is an inline input field:
                                    <div class="input-field inline">
                                        <input id="email" type="email" class="validate">
                                        <label for="email" data-error="wrong" data-success="right">Email</label>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a href="#!" class="modal-action modal-close waves-effect waves-green btn green ">Close</a>
            </div>
        </div>

        <!--Current Task Modal-->
        <div id="current_task" class="modal  modal-fixed-footer" style="width:90% !important">
            <div class="modal-content ">
                <div class="modal-body">
                    <h4 class="left-align" id="task_name"> Changeover</h4>
                    <h6 class="left-align" id="task_date"> 2017-11-14</h6>
                    <div class="divider"></div>
                    <p id="task_content" class="flow-text">Hey, I didn't have a chance to do change over. Can you please do this tonight? Just make sure everything is filled.</p>

                </div>
            </div>

            <div class="modal-footer">
                <a href="#!" class="modal-action modal-close waves-effect waves-red btn-flat ">Cancel</a>
                <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat ">Accept</a>
            </div>
        </div>
    </div>

    <script>
        $exp = new Array();

        //Temp Variables to be removed when database connection has been set
        var links = ["#recipe_view", "#recipe_search", "#recipe_edit", "#recipe_add"];
        $currentLab = 122;

        var groupedData;
        $numOfApps = 0;

        //Materialize CSS setup calls
        $(document).ready(function () {
            $('.modal').modal();
            $('.collapsible').collapsible();
            $('ul.tabs').tabs();
            $('ul.tabs').tabs('select_tab', 'tab_id');
            $(".button-collapse").sideNav();
            $('#timestamp').html(
                function () {
                    var time = new Date();

                    return "Last time checked:  " + time.toUTCString();
                }
            );
        });


        //Loading Indicatior for any ajax calls
        var $loading = $('#loadingDiv').hide();
        $(document)
            .ajaxStart(function () {
                $loading.show();
            })
            .ajaxStop(function () {
                $loading.hide();
            });


        //Grabs current lab setup
        $(document).ready(function () {

            $.ajax
                ({
                    type: "GET",
                    url: "https://www.bradfriebe.com/chemstock/getexperiments.php",
                    crossDomain: true,
                    dataType: "json",
                    success: function (data) {
                        //$exp = data;
                        groupedData = _.groupBy(data, function (d) { return d.labID });
                       // $.each(groupedData, function (key, value) {
                            FilterLabView($currentLab);
                       // });
                    },
                    error: function (data) {
                        alert('There was an error getting application info');
                    }
                });
        });

        //Filters through the experiments
        function IconSwap() {
            if ($('#recipe_search').hasClass('hide')) {
                $('#menu_icon').html("arrow_back");
                $('#recipe_view').addClass("hide");
                $('#recipe_search').removeClass("hide");
            }
            //} else {
            //    $('#menu_icon').html("menu");
            //    $('#recipe_search').addClass("hide");
            //    $('#recipe_view').removeClass("hide");
            //}
        }
        function FilterLabView(lab) {

            $('#lab_name').html(groupedData[lab][0].labName);
            $.each(groupedData[lab], function (key, value) {
                $('#exp_collection').append(
                    "<li>" +
                    " <div class='collapsible-header'><i class='material-icons'>filter_drama</i><span>" + value.experimentName + "</span ></div >" +
                    "<div class='collapsible-body'></div></li>"
                );
            });

        }
        //Populates modals for experiments
        function DisplayRecipe(recipe_id) {
            $('#menu_icon').html("arrow_back");
            $('#lab_collap').html("");
            $('#lab_name').html("<h5>" + groupedData[id_lab][0].labName + "</h5>");

            $.each(groupedData[id_lab], function (key, value) {
                $('#lab_collap').append(
                    "<li>" +
                    " <div class='collapsible-header'><i class='material-icons'>filter_drama</i><span>" + value.experimentName + "</span ></div >" +
                    "<div class='collapsible-body'></div></li>"
                );
            });
        }
        //Switches application and lab views
        function toggle_view(id_name) {

            if (id_name == "recipe_view") {
                $('#recipe_view').removeClass("hide");
                $('#recipe_search').addClass("hide");
                $('#menu_icon').html("arrow_back");
            }
            $('.button-collapse').sideNav('hide');
        }

        function RecipeView() {
            $('#menu_icon').html("arrow_back");
            $('#recipe_search').addClass("hide");
            $('#recipe_view').removeClass("hide");
        }


    </script>
</body>
</html>