<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
    <!--<link rel="stylesheet" type="text/css" href="css/login.css">-->
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css" media="screen,projection" />
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/googleOAuth.js"></script>
    <!--Import jQuery before materialize.js-->
    <script type="text/javascript" src="js/materialize.min.js"></script>
    <script type="text/javascript" src="js/lodash.min.js"></script>
    <script type="text/javascript" src="js/main.js"></script>
    <title>Recipes</title>
</head>

<body class="green lighten-2">
    <!--Navigation Bar-->
    <ul class="side-nav" id="mobile">
        <li class="logo center">
            <img src=" img/logo.png" />
        </li>
        <li><a href="#!">Lab View</a></li>
        <li ><a href="#!">Tasks</a></li>
        <li><a href="contactView.html">Contact Staff</a></li>
        <li class="active"><a href="#!">Recipes</a></li>
        <li><a href="calculator.html">Function Calculator</a></li>
    </ul>
    <div class="navbar-fixed">
        <nav>
            <div class="nav-wrapper green">
                <div class="container">
                    <a href="#!" class="brand-logo">ChemStock</a>
                    <a href="#!" data-activates="mobile" class="button-collapse" onclick="IconSwap();">
                        <i class="material-icons" id="menu_icon" >menu</i>
                    </a>
                    <ul class="right hide-on-med-and-down">
                        <li><a href="#!">Lab View</a></li>
                        <li><a href="#!">Tasks</a></li>
                        <li><a href="contactView.html">Contact Staff</a></li>
                        <li class="active"><a href="#!">Recipes</a></li>
                        <li><a href="calculator.html">Function Calculator</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>

    <br />

    <!--Loading Circle-->
    <div class="preloader-wrapper big active" id="loadingDiv" style="position:fixed; top:50%; left:50%; z-index: 1;">
        <div class="spinner-layer spinner-blue-only">
            <div class="circle-clipper left">
                <div class="circle"></div>
            </div><div class="gap-patch">
                <div class="circle"></div>
            </div><div class="circle-clipper right">
                <div class="circle"></div>
            </div>
        </div>
    </div>


    <!--View Area-->
    <div class=" row " id="bottom_view">
        <div id="recipe_search" class="col s12">
            <nav>
                <div class="nav-wrapper green lighten-4">
                    <form>
                        <div class="input-field">
                            <input id="search" type="search" required>
                            <label class="label-icon" for="search"><i class="material-icons">search</i></label>
                            <i class="material-icons">close</i>
                        </div>
                    </form>
                </div>
            </nav>

            <div class="card-panel z-depth-1">
                <h5>Recipes: All</h5>
                <div class=" divider"></div>

                <div id="pend" >
                    <ul class="collection" id="recipe_collection">
                       <!-- <li class="collection-item"><div>Methenol<a href="#!" class="secondary-content" onclick="toggle_view('recipe_view');"><i class="material-icons">send</i></a></div></li>-->
                    </ul>
                </div>
                <p id="timestamp">Last Updated 11:9:17</p>
            </div>

            <div class="fixed-action-btn horizontal">
                <a class="btn-floating btn-large red" onclick="GenerateRecipeAdd()">
                    <i class="large material-icons">mode_edit</i>
                </a>
            </div>
        </div>
        <div id="recipe_view" class=" col s12 hide">
            <div class="card-panel z-depth-1">
                <h4 id="recipe_name">0.050 M Methanol</h4>
                <h6 id="recipe_id" class="hide">idname</h6>
                <div class=" divider"></div>
                <br />
                 <h5 id="recipe_amt" ><b>Prep Quantity: </b>2L</h5>
                <h5 id="recipe_expTitle"><b>Experiment: </b><br />CHEM 122 Conductivity</h5>
                <h5 id="recipe_required"><b>Reqired Chemicals: </b>Methanol(4ml), Water(1996ml)</h5>
                <h5 id="recipe_formula"><b>Formula/FW:</b><br /> CH4O , 32.04 g/mol</h5>

                <h5><b>Procedure:</b></h5>
                <p id="recipe_text" class="flow-text">
                    With a 2 L volumetric flask,  fill roughly quarter ways with distilled water. Measure out
                    4 mls of methanol and add to flask. Use squirt bottle to get all the methanol to the flask. Fill to line
                    making sure that the closer you get to the mark, to switch to squirt bottle and eye dropper to avoid going over. 
                    Once finished, add stir bar to flask and stir for roughly 20 mins.
                </p>
                <p id="timestamp">Last Updated 11:9:17</p>
            </div>


            <div class="fixed-action-btn horizontal">
                <a class="btn-floating btn-large red" onclick="GenerateRecipeEdit()";>
                    <i class="large material-icons">mode_edit</i>
                </a>

            </div>

        </div>
        <div id="recipe_edit" class=" col s12 hide">
            <div class="card-panel z-depth-1">

                <form class="col s12" id="editform" name="form" method="post">

                    <div class="row hide">
                        <div class="input-field col s12">
                            <input placeholder="Placeholder" id="edit_recipe_id" type="text" class="validate" name="id" value="">
                            <label for="first_name">Name of Recipe</label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="input-field col s12">
                            <input placeholder="Placeholder" id="edit_recipe_name" type="text" class="validate" name="name">
                            <label for="first_name">Name of Recipe</label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="input-field col s12">
                            <input placeholder="Placeholder" id="edit_recipe_expTitle" type="text" class="validate" name="experiment">
                            <label for="first_name">Name of Experiment</label>
                        </div>
                        </div>

                        <div class="row">
                            <div class="input-field col s12">
                                <input placeholder="Placeholder" id="edit_recipe_amt" type="text" class="validate"name="prepQuantity">
                                <label for="first_name">Amount of Prep</label>
                            </div>
                            <div class="input-field col s12">
                                <select id="edit_recipe_prefix" name="prepType">
                                    <option value="" disabled selected>Prefix</option>
                                    <option value="Liters">Liters</option>
                                    <option value="Grams">Grams</option>
                                    <option value="Mililiters">Mililiters</option>
                                </select>
                                <!--<label>Materialize Select</label>-->
                            </div>
                        </div>
                    <div class="row">
                        <div class="input-field col s12">
                            <input placeholder="Placeholder" id="edit_recipe_formula" type="text" class="validate" name="formula">
                            <label for="first_name">Formula/FW</label>
                        </div>
                    </div>
                    <!--<div class="row">
                        <div class="input-field col s12">
                            <input placeholder="Placeholder" id="edit_recipe_required" type="text" class="validate">
                            <label for="first_name">Required Chemicals</label>
                        </div>
                    </div>-->
                    <div class="row">
                        <div class="input-field col s12">
                            <textarea id="edit_recipe_required" class="materialize-textarea" name="requiredChemicals"></textarea>
                            <label for="edit_recipe_required">Required Chemicals</label>
                        </div>
                    </div>
                    <!--<div class="row">
                        <div class="input-field col s12">
                            <input placeholder="Placeholder" id="edit_recipe_text" type="text" class="validate">
                            <label for="first_name">Recipe Body</label>
                        </div>


                    </div>-->
                    <div class="row">
                        <div class="input-field col s12">
                            <textarea id="edit_recipe_text" class="materialize-textarea" name="prepProcedure"></textarea>
                            <label for="edit_recipe_text">Recipe</label>
                        </div>
                    </div>
</form>



                <p id="timestamp">Last Updated 11:9:17</p>
            </div>
            <div class="fixed-action-btn horizontal click-to-toggle">
                <a class="btn-floating btn-large red">
                    <i class="material-icons">menu</i>
                </a>
                <ul>
                    <li><a class="btn-floating green" id="editclick"><i class="material-icons">publish</i></a></li>
                    <li><a class="btn-floating blue darken-1"><i class="material-icons">cancel</i></a></li>

                </ul>
            </div>
        </div>
        <div id="recipe_add" class=" col s12 hide">
            <div class="card-panel z-depth-1">

                <form class="col s12" id="form" name="form" method="post">
                    <div class="row">
                        <div class="input-field col s12">
                            <input placeholder="Placeholder" id="add_recipe_name" type="text" class="validate" name="name">
                            <label for="first_name">Name of Recipe</label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="input-field col s12">
                            <input placeholder="Placeholder" id="add_recipe_expTitle" type="text" class="validate" name="experiment">
                            <label for="first_name">Name of Experiment</label>
                        </div>
                    </div>

                    <div class="row">
                        <div class="input-field col s12">
                            <input placeholder="Placeholder" id="add_recipe_amt" type="text" class="validate" name="prepQuantity">
                            <label for="first_name">Amount of Prep</label>
                        </div>
                        <div class="input-field col s12">
                            <select id="add_recipe_prefix"  name="prepType">
                                <option value="" disabled selected>Prefix</option>
                                <option value="Liters">Liters</option>
                                <option value="Grams">Grams</option>
                                <option value="Mililiters">Mililiters</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="input-field col s12">
                            <input placeholder="Placeholder" id="add_recipe_formula" type="text" class="validate" name=" formula">
                            <label for="first_name">Formula/FW</label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="input-field col s12">
                            <textarea id="add_recipe_required" class="materialize-textarea" name="requiredChemicals"></textarea>
                            <label for="add_recipe_required">Required Chemicals</label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="input-field col s12">
                            <textarea id="add_recipe_text" class="materialize-textarea" name=" prepProcedure"></textarea>
                            <label for="add_recipe_text">Recipe</label>
                        </div>
                    </div>
                </form>
                <p id="timestamp">Last Updated 11:9:17</p>
            </div>
            <div class="fixed-action-btn horizontal click-to-toggle">
                <a class="btn-floating btn-large red">
                    <i class="material-icons">menu</i>
                </a>
                <ul>
                    <li><a class="btn-floating green" id="testclick"><i class="material-icons">publish</i></a></li>
                    <li><a class="btn-floating blue darken-1"><i class="material-icons">cancel</i></a></li>

                </ul>
            </div>
        </div>
    </div>

    <script>
        $exp = new Array();

        //Temp Variables to be removed when database connection has been set
        var links = ["#recipe_view", "#recipe_search", "#recipe_edit", "#recipe_add"];
        $currentLab = 122;

        var groupedData;
        $numOfApps = 0;

        //Materialize CSS setup calls
        $(document).ready(function () {
            $('.modal').modal();
            $('.collapsible').collapsible();
            $('ul.tabs').tabs();
            $('ul.tabs').tabs('select_tab', 'tab_id');
            $(".button-collapse").sideNav();
            $('#edit_recipe_text').val('New Text');
            $('#edit_recipe_text').trigger('autoresize');
            $('#edit_recipe_required').val('New Text');
            $('#edit_recipe_required').trigger('autoresize');
            $('#timestamp').html(
                function () {
                    var time = new Date();

                    return "Last time checked:  " + time.toUTCString();
                }
            );
        });


        //Loading Indicatior for any ajax calls
        var $loading = $('#loadingDiv').hide();
        $(document)
            .ajaxStart(function () {
                $loading.show();
            })
            .ajaxStop(function () {
                $loading.hide();
            });


        //Grabs current lab setup
        $(document).ready(function () {
            GenerateRecipe();
        });


        function GenerateRecipe() {
            $.ajax
                ({
                    type: "GET",
                    url: "https://www.bradfriebe.com/chemstock/getrecipe.php",
                    crossDomain: true,
                    dataType: "json",
                    success: function (data) {

                        $.each(data, function (key, value) {
                            $('#recipe_collection').append(
                                "<li class='collection-item'><div>" + value.name + "<a href='#!' class='secondary-content' onclick='GenerateRecipeView(" + value.id + ");'><i class='material-icons'>send</i></a></div></li>"
                               );
                        });
                    },
                    error: function (data) {
                        alert('There was an error getting the list of recipes...');
                    }
                });
        }

        function GenerateRecipeView(x) {
            $.ajax
                ({
                    type: "GET",
                    url: "https://www.bradfriebe.com/chemstock/getrecipe.php",
                    crossDomain: true,
                    dataType: "json",
                    data:{id:x},
                    success: function (data) {
                        $('#recipe_name').html(data.name);
                        $('#recipe_expTitle').html("<b>Experiment: </b><br />" + data.experiment );
                        $('#recipe_amt').html("<b>Prep Quantity: </b><br />" + data.prepQuantity + " " + data.prepType );
                        $('#recipe_formula').html("<b>Formula/FW:</b><br />" + data.formula);
                        $('#recipe_text').html(data.prepProcedure);
                        $('#recipe_required').html("<b>Reqired Chemicals: </b>" + data.requiredChemicals);
                        $('#recipe_id').html(data.id);
                    },
                    error: function (data) {
                        alert('There was an error getting recipe info');
                    }
                });

            $('#recipe_view').removeClass("hide");
            $('#recipe_search').addClass("hide");
            $('#menu_icon').html("arrow_back");
        }

        function GenerateRecipeEdit() {

            var y = $('#recipe_id').html();
            y = parseInt(y);
            $.ajax
                ({
                    type: "GET",
                    url: "https://www.bradfriebe.com/chemstock/getrecipe.php",
                    crossDomain: true,
                    dataType: "json",
                    data: { id: y },
                    success: function (data) {
                        console.log(data);
                        $('#recipe_view').addClass("hide");
                        $('#recipe_edit').removeClass("hide");
                        
                        $('#edit_recipe_name').val(data.name);
                        $('#edit_recipe_expTitle').val( data.experiment);
                        $('#edit_recipe_amt').val(data.prepQuantity);
                        $('#edit_recipe_prefix').val(data.prepType);
                        $('#edit_recipe_formula').val(data.formula);
                        $('#edit_recipe_text').val(data.prepProcedure);
                        $('#edit_recipe_required').val(data.requiredChemicals);
                       
                    },
                    error: function (data) {
                        alert('There was an error getting application info');
                    }
                });

            $('#recipe_view').removeClass("hide");
            $('#recipe_search').addClass("hide");
            $('#menu_icon').html("arrow_back");
        }
        function GenerateRecipeAdd(){
            $('#recipe_search').addClass("hide");
            $('#recipe_add').removeClass("hide");
            $('#menu_icon').html("arrow_back");
        }

        $('#testclick').on('click', function (e) {
            e.preventDefault();
            var formData = new FormData($('#form')[0]);





            //for (var pair of formData.entries()) {
            // console.log(pair[0] + ', ' + pair[1]);
            //}
            $.ajax({
                type: 'POST',
                url: 'https://www.bradfriebe.com/chemstock/addrecipe.php',
                crossDomain: true,
                data: formData,
                contentType: false,
                processData: false,
                success: function (data) {
                    if (data != "") {
                        alert(data);
                        //alert('ERROR');
                    }
                    else {
                        alert("Updated to database");
                        alert(JSON.stringify(data));
                    }
                    // updated successfully
                },
                error: function (data) {
                    alert(json.stringify(data));
                    alert('There was an internal error, please try again later');
                }

            });

        })
        $('#editclick').on('click', function (e) {
            e.preventDefault();
            var y = $('#recipe_id').html();
            y = parseInt(y);
            $('#edit_recipe_id').val(y);
            var formData = new FormData($('#editform')[0]);





            //for (var pair of formData.entries()) {
            // console.log(pair[0] + ', ' + pair[1]);
            //}
            $.ajax({
                type: 'POST',
                url: 'https://www.bradfriebe.com/chemstock/editrecipe.php',
                crossDomain: true,
                data: formData,
                contentType: false,
                processData: false,
                success: function (data) {
                    if (data != "") {
                        alert(data);
                        //alert('ERROR');
                    }
                    else {
                        alert("Updated to database");
                    }
                    // updated successfully
                },
                error: function (data) {
                    //alert(data);
                    alert('There was an internal error, please try again later');
                }

            });

        })


        //function AddRecipe() {
        //    var formData = new FormData($('#form')[0]);



        //    //formData.append('name', 'Meth');
        //    //formData.append('prepQuantity', '2');
        //    //formData.append('prepType', 'Liters');
        //    //formData.append('experiment', 'Nah:');
        //    //formData.append('requiredChemicals', 'na');
        //    //formData.append('formula', 'naaaa');
        //    //formData.append('prepProcedure', 'in a mix');

        //    //for (var pair of formData.entries()) {
        //       // console.log(pair[0] + ', ' + pair[1]);
        //    //}
        //    $.ajax({
        //        type: 'POST',
        //        url: 'https://www.bradfriebe.com/chemstock/addrecipe.php',
        //        crossDomain: true,
        //        data: formData,
        //        contentType:false,
        //        processData: false,
        //        success: function (data) {
        //            if (data != "") {
        //                alert(data);
        //                //alert('ERROR');
        //            }
        //            else {
        //                alert("Updated to database");
        //                alert(JSON.stringify(data));
        //            }
        //            // updated successfully
        //        },
        //        error: function (data) {
        //            alert(json.stringify(data));
        //            alert('There was an internal error, please try again later');
        //        }

        //    });
        //}

        function ReturnVal(id) {
            return $(id).val();
        }

        //function UpdateRecipe() {

        //    var formData = new FormData();
            
        //    formData.append('id', 1);
        //    formData.append('name', "Meth" );
        //    formData.append('prepQuantity', "2");
        //    formData.append('prepType',"Liters" );
        //    formData.append('experiment', "Nah:");
        //    formData.append('requiredChemicals', "na");
        //    formData.append('formula', "naaaa");
        //    formData.append('prepProcedure', "in a mix");

        //    for (var pair of formData.entries()) {
        //        console.log(pair[0] + ', ' + pair[1]);
        //    }
        //    $.ajax({
        //        type:'POST',
        //        url: 'https://www.bradfriebe.com/chemstock/editrecipe.php',
        //        crossDomain: true,
        //        data: formData,
        //        processData: false,
        //        success: function (data) {
        //            if (data != "") {
        //                alert(data);
        //                //alert('ERROR');
        //            }
        //            else {
        //                alert("Updated to database");
        //            }
        //            // updated successfully
        //        },
        //        error: function (data) {
        //            //alert(data);
        //            alert('There was an internal error, please try again later');
        //        }

        //    });
        //}


        //Filters through the experiments
        //Filters through the experiments
        function IconSwap() {

            if ($('#menu_icon').html("arrow_back")) {
                if ($('#recipe_edit').hasClass("hide")) {
                    $('#recipe_view').addClass("hide");
                     $('#recipe_add').addClass("hide");
                    $('#recipe_search').removeClass("hide");
                    $('#menu_icon').html("menu");
                } else if ($('#recipe_view').hasClass("hide")) {
                    $('#recipe_edit').addClass("hide");
                    $('#recipe_add').addClass("hide");
                    $('#recipe_view').removeClass("hide");
                } else if ($('#recipe_view').hasClass("hide") && $('#recipe_edit').hasClass("hide")) {
                    $('#recipe_search').removeClass("hide");
                    $('#recipe_add').addClass("hide");
                   // $('#recipe_view').addClass("hide");
                }
                $('.button-collapse').sideNav('hide');

            }

        }
        function FilterLabView(lab) {

            $('#lab_name').html(groupedData[lab][0].labName);
            $.each(groupedData[lab], function (key, value) {
                $('#exp_collection').append(
                    "<li>" +
                    " <div class='collapsible-header'><i class='material-icons'>filter_drama</i><span>" + value.experimentName + "</span ></div >" +
                    "<div class='collapsible-body'></div></li>"
                );
            });

        }

        function ViewRecipe() {

        }

        //Populates modals for experiments
        function DisplayRecipe(recipe_id) {
            $('#menu_icon').html("arrow_back");
            $('#lab_collap').html("");
            $('#lab_name').html("<h5>" + groupedData[id_lab][0].labName + "</h5>");

            $.each(groupedData[id_lab], function (key, value) {
                $('#lab_collap').append(
                    "<li>" +
                    " <div class='collapsible-header'><i class='material-icons'>filter_drama</i><span>" + value.experimentName + "</span ></div >" +
                    "<div class='collapsible-body'></div></li>"
                );
            });
        }
        //Switches application and lab views
        function toggle_view(id_name) {

            if (id_name == "recipe_view") {
                $('#recipe_view').removeClass("hide");
                $('#recipe_search').addClass("hide");
                $('#menu_icon').html("arrow_back");
            }
            $('.button-collapse').sideNav('hide');
        }

        function RecipeView() {
            $('#menu_icon').html("arrow_back");
            $('#recipe_search').addClass("hide");
            $('#recipe_view').removeClass("hide");
        }


    </script>
</body>
</html>